# ğŸ—„ï¸ æ•°æ®åº“è®¾ç½®æŒ‡å—

## âŒ é”™è¯¯ä¿¡æ¯

å¦‚æœé‡åˆ°ä»¥ä¸‹é”™è¯¯ï¼š
```
Could not find the table 'public.generations' in the schema cache
```

è¿™è¡¨ç¤ºæ•°æ®åº“è¡¨è¿˜æ²¡æœ‰åœ¨ Supabase ä¸­åˆ›å»ºã€‚

---

## âœ… è§£å†³æ–¹æ¡ˆï¼šæ‰§è¡Œæ•°æ®åº“è¿ç§»

### æ–¹æ³•ä¸€ï¼šé€šè¿‡ Supabase Dashboardï¼ˆæ¨èï¼‰

#### æ­¥éª¤ 1ï¼šç™»å½• Supabase
1. è®¿é—® [supabase.com](https://supabase.com)
2. ç™»å½•æ‚¨çš„è´¦æˆ·
3. é€‰æ‹©æ‚¨çš„é¡¹ç›®

#### æ­¥éª¤ 2ï¼šæ‰“å¼€ SQL Editor
1. ç‚¹å‡»å·¦ä¾§èœå•çš„ **SQL Editor**ï¼ˆSQL ç¼–è¾‘å™¨ï¼‰
2. ç‚¹å‡» **"New query"**ï¼ˆæ–°å»ºæŸ¥è¯¢ï¼‰æŒ‰é’®

#### æ­¥éª¤ 3ï¼šæ‰§è¡Œè¿ç§»è„šæœ¬
1. æ‰“å¼€é¡¹ç›®ä¸­çš„ `supabase/migrations/001_initial_schema.sql` æ–‡ä»¶
2. å¤åˆ¶**å…¨éƒ¨å†…å®¹**
3. ç²˜è´´åˆ° Supabase SQL Editor ä¸­
4. ç‚¹å‡» **"Run"**ï¼ˆè¿è¡Œï¼‰æŒ‰é’®æ‰§è¡Œ

#### æ­¥éª¤ 4ï¼šéªŒè¯è¡¨å·²åˆ›å»º
æ‰§è¡Œå®Œæˆåï¼Œåœ¨å·¦ä¾§èœå•ä¸­ï¼š
1. ç‚¹å‡» **Table Editor**ï¼ˆè¡¨ç¼–è¾‘å™¨ï¼‰
2. æ‚¨åº”è¯¥èƒ½çœ‹åˆ°ä»¥ä¸‹è¡¨ï¼š
   - âœ… `profiles` - ç”¨æˆ·ä¿¡æ¯è¡¨
   - âœ… `generations` - ç”Ÿæˆè®°å½•è¡¨

---

### æ–¹æ³•äºŒï¼šé€šè¿‡ Supabase CLIï¼ˆé«˜çº§ç”¨æˆ·ï¼‰

å¦‚æœæ‚¨å®‰è£…äº† Supabase CLIï¼š

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
supabase db push
```

---

## ğŸ“‹ è¿ç§»è„šæœ¬ä¼šåˆ›å»ºä»€ä¹ˆï¼Ÿ

æ‰§è¡Œè¿ç§»è„šæœ¬åï¼Œä¼šåˆ›å»ºï¼š

### 1. **profiles è¡¨**ï¼ˆç”¨æˆ·ä¿¡æ¯ï¼‰
- `id` - ç”¨æˆ·IDï¼ˆå…³è” auth.usersï¼‰
- `credits` - ç§¯åˆ†ä½™é¢ï¼ˆé»˜è®¤ 5ï¼‰
- `is_subscriber` - æ˜¯å¦è®¢é˜…ç”¨æˆ·
- `created_at` / `updated_at` - æ—¶é—´æˆ³

### 2. **generations è¡¨**ï¼ˆç”Ÿæˆè®°å½•ï¼‰
- `id` - è®°å½•ID
- `user_id` - ç”¨æˆ·ID
- `original_image_url` - åŸå›¾URL
- `generated_image_url` - ç”Ÿæˆå›¾URL
- `prompt_used` - ä½¿ç”¨çš„Prompt
- `style_preset` - é£æ ¼é¢„è®¾
- `status` - çŠ¶æ€ï¼ˆpending/completed/failedï¼‰
- `error_message` - é”™è¯¯ä¿¡æ¯
- `created_at` / `updated_at` - æ—¶é—´æˆ³

### 3. **å®‰å…¨ç­–ç•¥ï¼ˆRLSï¼‰**
- ç”¨æˆ·åªèƒ½æŸ¥çœ‹å’Œæ“ä½œè‡ªå·±çš„æ•°æ®
- è‡ªåŠ¨å¯ç”¨è¡Œçº§å®‰å…¨ï¼ˆRow Level Securityï¼‰

### 4. **è‡ªåŠ¨è§¦å‘å™¨**
- æ–°ç”¨æˆ·æ³¨å†Œæ—¶è‡ªåŠ¨åˆ›å»º Profileï¼ˆèµ é€ 5 ç§¯åˆ†ï¼‰
- è‡ªåŠ¨æ›´æ–° `updated_at` æ—¶é—´æˆ³

---

## ğŸ§ª éªŒè¯è®¾ç½®æ˜¯å¦æˆåŠŸ

### æ–¹æ³• 1ï¼šåœ¨ Supabase Dashboard æ£€æŸ¥
1. è¿›å…¥ **Table Editor**
2. æŸ¥çœ‹æ˜¯å¦æœ‰ `profiles` å’Œ `generations` è¡¨
3. ç‚¹å‡»è¡¨åï¼ŒæŸ¥çœ‹è¡¨ç»“æ„æ˜¯å¦æ­£ç¡®

### æ–¹æ³• 2ï¼šåœ¨åº”ç”¨ä¸­æµ‹è¯•
1. é‡å¯å¼€å‘æœåŠ¡å™¨ï¼š
   ```bash
   npm run dev
   ```
2. å°è¯•æ³¨å†Œæ–°ç”¨æˆ·æˆ–ç”Ÿæˆå›¾ç‰‡
3. å¦‚æœä¸å†æŠ¥é”™ï¼Œè¯´æ˜é…ç½®æˆåŠŸ

---

## âš ï¸ å¸¸è§é—®é¢˜

### Q1: æ‰§è¡Œ SQL æ—¶æç¤ºæƒé™é”™è¯¯
**è§£å†³æ–¹æ³•ï¼š**
- ç¡®ä¿æ‚¨ä½¿ç”¨çš„æ˜¯é¡¹ç›®çš„ **Service Role Key** æˆ–æ‹¥æœ‰ç®¡ç†å‘˜æƒé™
- æ£€æŸ¥ RLS ç­–ç•¥æ˜¯å¦æ­£ç¡®åˆ›å»º

### Q2: è¡¨å·²å­˜åœ¨ä½†ä»æœ‰é”™è¯¯
**è§£å†³æ–¹æ³•ï¼š**
- åœ¨ Supabase Dashboard ä¸­åˆ·æ–°é¡µé¢
- æ£€æŸ¥è¡¨åæ˜¯å¦æ­£ç¡®ï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰
- ç¡®è®¤è¡¨åœ¨ `public` schema ä¸­

### Q3: è§¦å‘å™¨æ²¡æœ‰è‡ªåŠ¨åˆ›å»º Profile
**è§£å†³æ–¹æ³•ï¼š**
- æ£€æŸ¥ `handle_new_user()` å‡½æ•°æ˜¯å¦åˆ›å»ºæˆåŠŸ
- æ£€æŸ¥ `on_auth_user_created` è§¦å‘å™¨æ˜¯å¦ç»‘å®š
- å¯ä»¥åœ¨ SQL Editor ä¸­æ‰‹åŠ¨æµ‹è¯•è§¦å‘å™¨

### Q4: RLS ç­–ç•¥å¯¼è‡´æ— æ³•è®¿é—®æ•°æ®
**è§£å†³æ–¹æ³•ï¼š**
- ç¡®è®¤ç”¨æˆ·å·²ç™»å½•ï¼ˆ`auth.uid()` ä¸ä¸ºç©ºï¼‰
- æ£€æŸ¥ç­–ç•¥ä¸­çš„ `user_id` æ˜¯å¦ä¸ `auth.uid()` åŒ¹é…
- æŸ¥çœ‹ Supabase æ—¥å¿—ä¸­çš„è¯¦ç»†é”™è¯¯ä¿¡æ¯

---

## ğŸ”„ é‡æ–°æ‰§è¡Œè¿ç§»ï¼ˆå¦‚æœéœ€è¦ï¼‰

å¦‚æœè¿ç§»æ‰§è¡Œå¤±è´¥æˆ–éœ€è¦é‡æ–°æ‰§è¡Œï¼š

```sql
-- æ³¨æ„ï¼šè¿™ä¼šåˆ é™¤æ‰€æœ‰æ•°æ®ï¼
DROP TABLE IF EXISTS generations CASCADE;
DROP TABLE IF EXISTS profiles CASCADE;
DROP FUNCTION IF EXISTS handle_new_user() CASCADE;
DROP FUNCTION IF EXISTS update_updated_at_column() CASCADE;
```

ç„¶åé‡æ–°æ‰§è¡Œ `001_initial_schema.sql` è„šæœ¬ã€‚

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [Supabase SQL Editor æ–‡æ¡£](https://supabase.com/docs/guides/database/tables)
- [Row Level Security æ–‡æ¡£](https://supabase.com/docs/guides/auth/row-level-security)
- [æ•°æ®åº“è¿ç§»æœ€ä½³å®è·µ](https://supabase.com/docs/guides/database/migrations)

---

<div align="center">
  <strong>æ‰§è¡Œå®Œè¿ç§»åï¼Œé‡æ–°æµ‹è¯•åº”ç”¨å³å¯ï¼</strong> âœ…
</div>
