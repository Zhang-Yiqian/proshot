# Supabase Storage è®¾ç½®æŒ‡å—

## âŒ é”™è¯¯ä¿¡æ¯

```
StorageApiError: Bucket not found
```

è¿™ä¸ªé”™è¯¯è¡¨ç¤º Supabase Storage ä¸­çš„ `originals` bucket è¿˜æ²¡æœ‰åˆ›å»ºã€‚

---

## âœ… è§£å†³æ–¹æ¡ˆï¼šåˆ›å»º Storage Bucket

### æ–¹æ³•ä¸€ï¼šé€šè¿‡ Supabase Dashboardï¼ˆæ¨èï¼‰

#### æ­¥éª¤ 1ï¼šç™»å½• Supabase
1. è®¿é—® [supabase.com](https://supabase.com)
2. ç™»å½•æ‚¨çš„è´¦æˆ·
3. é€‰æ‹©æ‚¨çš„é¡¹ç›®

#### æ­¥éª¤ 2ï¼šè¿›å…¥ Storage é¡µé¢
1. ç‚¹å‡»å·¦ä¾§èœå•çš„ **Storage**ï¼ˆå­˜å‚¨ï¼‰
2. å¦‚æœè¿™æ˜¯ç¬¬ä¸€æ¬¡ä½¿ç”¨ï¼Œä¼šçœ‹åˆ° "Create a new bucket" æç¤º

#### æ­¥éª¤ 3ï¼šåˆ›å»º `originals` Bucket
1. ç‚¹å‡» **"New bucket"** æˆ– **"Create bucket"** æŒ‰é’®
2. å¡«å†™ä»¥ä¸‹ä¿¡æ¯ï¼š
   - **Nameï¼ˆåç§°ï¼‰**: `originals`
   - **Public bucketï¼ˆå…¬å¼€å­˜å‚¨æ¡¶ï¼‰**: âœ… **å‹¾é€‰**ï¼ˆé‡è¦ï¼ï¼‰
   - **File size limitï¼ˆæ–‡ä»¶å¤§å°é™åˆ¶ï¼‰**: å¯ä»¥è®¾ç½®ä¸º `50MB` æˆ–æ›´å¤§
   - **Allowed MIME typesï¼ˆå…è®¸çš„æ–‡ä»¶ç±»å‹ï¼‰**: å¯ä»¥ç•™ç©ºï¼ˆå…è®¸æ‰€æœ‰ç±»å‹ï¼‰æˆ–å¡«å†™ `image/*`

3. ç‚¹å‡» **"Create bucket"** åˆ›å»º

#### æ­¥éª¤ 4ï¼šåˆ›å»º `generated` Bucketï¼ˆå¯é€‰ï¼Œç”¨äºå­˜å‚¨ç”Ÿæˆçš„ç»“æœå›¾ï¼‰
1. å†æ¬¡ç‚¹å‡» **"New bucket"**
2. å¡«å†™ä¿¡æ¯ï¼š
   - **Name**: `generated`
   - **Public bucket**: âœ… **å‹¾é€‰**
   - **File size limit**: `50MB` æˆ–æ›´å¤§
   - **Allowed MIME types**: `image/*`

3. ç‚¹å‡» **"Create bucket"** åˆ›å»º

---

### æ–¹æ³•äºŒï¼šé€šè¿‡ SQL å‘½ä»¤

å¦‚æœæ‚¨ç†Ÿæ‚‰ SQLï¼Œä¹Ÿå¯ä»¥åœ¨ Supabase SQL Editor ä¸­æ‰§è¡Œï¼š

```sql
-- åˆ›å»º originals bucket
INSERT INTO storage.buckets (id, name, public)
VALUES ('originals', 'originals', true);

-- åˆ›å»º generated bucketï¼ˆå¯é€‰ï¼‰
INSERT INTO storage.buckets (id, name, public)
VALUES ('generated', 'generated', true);
```

**æ³¨æ„ï¼š** ä½¿ç”¨ SQL åˆ›å»ºåï¼Œè¿˜éœ€è¦è®¾ç½®å­˜å‚¨ç­–ç•¥ï¼ˆStorage Policiesï¼‰ã€‚

---

## ğŸ”’ è®¾ç½®å­˜å‚¨ç­–ç•¥ï¼ˆStorage Policiesï¼‰

åˆ›å»º Bucket åï¼Œéœ€è¦è®¾ç½®è®¿é—®ç­–ç•¥ï¼Œå…è®¸ç”¨æˆ·ä¸Šä¼ å’Œè¯»å–æ–‡ä»¶ã€‚

### åœ¨ Supabase Dashboard ä¸­è®¾ç½®ï¼š

1. è¿›å…¥ **Storage** â†’ ç‚¹å‡» `originals` bucket
2. ç‚¹å‡» **"Policies"** æ ‡ç­¾
3. ç‚¹å‡» **"New Policy"** åˆ›å»ºæ–°ç­–ç•¥

#### ç­–ç•¥ 1ï¼šå…è®¸ç”¨æˆ·ä¸Šä¼ è‡ªå·±çš„æ–‡ä»¶

**ç­–ç•¥åç§°**: `Users can upload their own files`

**ç­–ç•¥ç±»å‹**: `INSERT`

**ç­–ç•¥å®šä¹‰**:
```sql
(bucket_id = 'originals'::text) AND ((auth.uid())::text = (storage.foldername(name))[1])
```

**è¯´æ˜**: å…è®¸ç”¨æˆ·åœ¨è‡ªå·±çš„æ–‡ä»¶å¤¹ï¼ˆä»¥ç”¨æˆ·IDå‘½åï¼‰ä¸­ä¸Šä¼ æ–‡ä»¶

#### ç­–ç•¥ 2ï¼šå…è®¸ç”¨æˆ·è¯»å–è‡ªå·±çš„æ–‡ä»¶

**ç­–ç•¥åç§°**: `Users can read their own files`

**ç­–ç•¥ç±»å‹**: `SELECT`

**ç­–ç•¥å®šä¹‰**:
```sql
(bucket_id = 'originals'::text) AND ((auth.uid())::text = (storage.foldername(name))[1])
```

#### ç­–ç•¥ 3ï¼šå…è®¸å…¬å¼€è¯»å–ï¼ˆå¦‚æœ bucket æ˜¯ publicï¼‰

**ç­–ç•¥åç§°**: `Public read access`

**ç­–ç•¥ç±»å‹**: `SELECT`

**ç­–ç•¥å®šä¹‰**:
```sql
bucket_id = 'originals'
```

**è¯´æ˜**: å¦‚æœ bucket è®¾ç½®ä¸º publicï¼Œè¿™ä¸ªç­–ç•¥å…è®¸æ‰€æœ‰äººè¯»å–æ–‡ä»¶

---

## ğŸ“‹ å¿«é€Ÿæ£€æŸ¥æ¸…å•

åˆ›å»ºå®Œæˆåï¼Œè¯·ç¡®è®¤ï¼š

- [ ] `originals` bucket å·²åˆ›å»º
- [ ] bucket è®¾ç½®ä¸º **Public**ï¼ˆå…¬å¼€ï¼‰
- [ ] å·²è®¾ç½®å­˜å‚¨ç­–ç•¥ï¼ˆè‡³å°‘å…è®¸ INSERT å’Œ SELECTï¼‰
- [ ] æµ‹è¯•ä¸Šä¼ åŠŸèƒ½æ˜¯å¦æ­£å¸¸

---

## ğŸ§ª æµ‹è¯• Storage æ˜¯å¦é…ç½®æˆåŠŸ

### æ–¹æ³• 1ï¼šåœ¨ Supabase Dashboard æµ‹è¯•
1. è¿›å…¥ **Storage** â†’ `originals` bucket
2. ç‚¹å‡» **"Upload file"**
3. ä¸Šä¼ ä¸€ä¸ªæµ‹è¯•å›¾ç‰‡
4. å¦‚æœä¸Šä¼ æˆåŠŸï¼Œè¯´æ˜é…ç½®æ­£ç¡®

### æ–¹æ³• 2ï¼šåœ¨åº”ç”¨ä¸­æµ‹è¯•
1. å¯åŠ¨åº”ç”¨ï¼š`npm run dev`
2. ç™»å½•è´¦æˆ·
3. ä¸Šä¼ ä¸€å¼ å›¾ç‰‡
4. å¦‚æœä¸å†æŠ¥é”™ï¼Œè¯´æ˜é…ç½®æˆåŠŸ

---

## âš ï¸ å¸¸è§é—®é¢˜

### Q1: åˆ›å»º bucket åä»ç„¶æŠ¥é”™
**è§£å†³æ–¹æ³•ï¼š**
- æ£€æŸ¥ bucket åç§°æ˜¯å¦å®Œå…¨åŒ¹é…ï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰
- ç¡®è®¤ bucket è®¾ç½®ä¸º Public
- æ£€æŸ¥å­˜å‚¨ç­–ç•¥æ˜¯å¦æ­£ç¡®è®¾ç½®

### Q2: ä¸Šä¼ æ–‡ä»¶æ—¶æç¤ºæƒé™ä¸è¶³
**è§£å†³æ–¹æ³•ï¼š**
- æ£€æŸ¥å­˜å‚¨ç­–ç•¥æ˜¯å¦æ­£ç¡®é…ç½®
- ç¡®è®¤ç”¨æˆ·å·²ç™»å½•
- æ£€æŸ¥ç­–ç•¥ä¸­çš„ bucket_id æ˜¯å¦æ­£ç¡®

### Q3: æ— æ³•è®¿é—®ä¸Šä¼ çš„æ–‡ä»¶ URL
**è§£å†³æ–¹æ³•ï¼š**
- ç¡®è®¤ bucket è®¾ç½®ä¸º Public
- æ£€æŸ¥å­˜å‚¨ç­–ç•¥æ˜¯å¦å…è®¸ SELECT
- ç¡®è®¤æ–‡ä»¶è·¯å¾„æ ¼å¼æ­£ç¡®

---

## ğŸ”§ ä¸´æ—¶è§£å†³æ–¹æ¡ˆï¼ˆå¦‚æœæš‚æ—¶ä¸æƒ³é…ç½® Storageï¼‰

å¦‚æœæ‚¨æš‚æ—¶ä¸æƒ³é…ç½® Supabase Storageï¼Œå¯ä»¥ä¿®æ”¹ä»£ç ä½¿ç”¨ Base64 ç¼–ç ç›´æ¥ä¼ é€’å›¾ç‰‡ï¼š

**æ³¨æ„ï¼š** è¿™ç§æ–¹æ³•åªé€‚åˆå°æ–‡ä»¶ï¼ˆ< 5MBï¼‰ï¼Œä¸æ¨èç”¨äºç”Ÿäº§ç¯å¢ƒã€‚

éœ€è¦æˆ‘å¸®æ‚¨å®ç°è¿™ä¸ªä¸´æ—¶æ–¹æ¡ˆå—ï¼Ÿ

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [Supabase Storage å®˜æ–¹æ–‡æ¡£](https://supabase.com/docs/guides/storage)
- [Storage Policies æ–‡æ¡£](https://supabase.com/docs/guides/storage/policies)

---

<div align="center">
  <strong>é…ç½®å®Œæˆåï¼Œé‡æ–°æµ‹è¯•åº”ç”¨å³å¯ï¼</strong> âœ…
</div>
